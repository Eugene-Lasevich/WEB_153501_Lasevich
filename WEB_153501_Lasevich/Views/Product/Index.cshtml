@model (List<Product> products, int currentPage, int totalPages)
@{
    ViewData["Title"] = "Каталог";
    var request = ViewContext.HttpContext.Request;
    var returnUrl = request.Path + request.QueryString.ToUriComponent();
    var categories = ViewData["categories"] as IEnumerable<Category>;
    string? category = request.Query["category"];
    var currentCategory = ViewData["currentCategory"] as string ?? "Все";

    int prev = Model.currentPage == 1 ? 1 : Model.currentPage - 1;
    int next = Model.currentPage == Model.totalPages ? Model.totalPages : Model.currentPage + 1;
}

<h1>Каталог</h1>

<div class="col-2 border-2">
    <ul class="nav">
        <li class="nav-item dropdown">
            <button class="btn dropdown-toggle" data-bs-toggle="dropdown"
                aria-expanded="false">
                @currentCategory
            </button>
            <ul class="dropdown-menu">
                <li>
                    <a class="dropdown-item" asp-controller="product" asp-route-category=@null>Все</a>
                </li>
                @if (categories != null)
                {
                    foreach (var item in categories)
                    {
                        <li>
                            <a class="dropdown-item" asp-controller="product" asp-route-category="@item.NormalizedName">
                                @item.Name
                            </a>
                        </li>
                    }
                }
            </ul>
        </li>
    </ul>
</div>

<div class="row offset-2">
    @foreach (var item in Model.products) {
        <div class="col-md-4 mb-4">
            <div class="card" style="width: 18rem;">
                <div class="image-container">
                    <img src="@item.ImagePath" class="card-img-top" alt="@item.Name">
                </div>
                <div class="card-body">
                    <h5 class="card-title">@item.Name</h5>
                    <p class="card-text">@item.Description</p>
                    <p class="card-text">Цена: @item.Price$</p>
                    <a asp-controller="Cart" asp-action="Add" asp-route-id="@item.Id" asp-route-returnUrl=@returnUrl class="btn btn-primary">Add to cart</a>
                </div>
            </div>
        </div>
    }
</div>

<nav aria-label="...">
    <ul class="pagination">
        <li class="page-item">
            <a class="page-link" href="@Url.Action("Index", "Product", new { category = category, pageNo = prev })"
                tabindex="-1" aria-disabled="true">
                Previous
            </a>
        </li>
        @for (int i = 1; i <= Model.totalPages; i++)
        {
            <li class="page-item @(Model.currentPage == i ? "active" : "")" aria-current="page">
                <a class="page-link" href="@Url.Action("Index", "Product", new {category = category, pageNo = i })"
                    tabindex="-1" aria-disabled="true">
                    @i
                </a>
            </li>
        }
        <li class="page-item">
            <a class="page-link" href="@Url.Action("Index", "Product", new { category = category, pageNo = next })"
                tabindex="-1" aria-disabled="true">
                Next
            </a>
        </li>
    </ul>
</nav>
